# MLflow æœ¬åœ°éƒ¨ç½²æµ‹è¯•ç¯å¢ƒ

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªMLflowæœ¬åœ°éƒ¨ç½²çš„æµ‹è¯•ç¯å¢ƒï¼Œä½¿ç”¨SQLiteä½œä¸ºåç«¯å­˜å‚¨ï¼Œæ¼”ç¤ºMLflowçš„æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬å®éªŒè·Ÿè¸ªã€å‚æ•°è®°å½•ã€æŒ‡æ ‡ç›‘æ§ã€æ¨¡å‹ç®¡ç†å’Œartifactå­˜å‚¨ã€‚

## æ–‡ä»¶æ¶æ„

```
/home/feng.hao.jie/test/
â”œâ”€â”€ my.db                    # MLflow SQLiteæ•°æ®åº“ (264K)
â”œâ”€â”€ mlartifacts/            # Artifactå­˜å‚¨ç›®å½• (56K)
â”œâ”€â”€ mlruns/                 # è¿è¡Œå…ƒæ•°æ®ç›®å½• (4.0Kï¼ŒåŸºæœ¬ä¸ºç©º)
â”œâ”€â”€ test_mlflow_local.py    # æµ‹è¯•è„šæœ¬ (8.0K)
â””â”€â”€ README.md              # æœ¬æ–‡æ¡£
```

### è¯¦ç»†ç›®å½•ç»“æ„

#### 1. my.db (264K)
- **ç±»å‹**: SQLiteæ•°æ®åº“æ–‡ä»¶
- **ç”¨é€”**: å­˜å‚¨å®éªŒå…ƒæ•°æ®ã€è¿è¡Œä¿¡æ¯ã€å‚æ•°ã€æŒ‡æ ‡ç­‰
- **å†…å®¹**:
  - å®éªŒå®šä¹‰å’Œé…ç½®
  - è¿è¡Œè®°å½•å’ŒçŠ¶æ€
  - å‚æ•°é”®å€¼å¯¹
  - æŒ‡æ ‡æ—¶é—´åºåˆ—æ•°æ®
  - Artifactè·¯å¾„å¼•ç”¨

#### 2. mlartifacts/ (56K)
```
mlartifacts/
â””â”€â”€ 1/                              # å®éªŒIDä¸º1
    â”œâ”€â”€ 5fd98e0a3030475593856f358c661525/   # è¿è¡ŒID
    â”‚   â””â”€â”€ artifacts/
    â”‚       â””â”€â”€ reports/
    â”‚           â””â”€â”€ test_report.txt         # æµ‹è¯•æŠ¥å‘Šæ–‡ä»¶
    â””â”€â”€ models/                             # æ¨¡å‹å­˜å‚¨
        â””â”€â”€ m-608a9a7c99f1439e877bfb8016b41097/
            â””â”€â”€ artifacts/
                â”œâ”€â”€ conda.yaml              # Condaç¯å¢ƒé…ç½®
                â”œâ”€â”€ MLmodel                 # MLflowæ¨¡å‹å…ƒæ•°æ®
                â”œâ”€â”€ model.pkl               # åºåˆ—åŒ–çš„æ¨¡å‹æ–‡ä»¶
                â”œâ”€â”€ python_env.yaml         # Pythonç¯å¢ƒé…ç½®
                â””â”€â”€ requirements.txt        # ä¾èµ–åŒ…åˆ—è¡¨
```

#### 3. mlruns/ (4.0K)
- **çŠ¶æ€**: åŸºæœ¬ä¸ºç©º
- **åŸå› **: ä½¿ç”¨SQLiteåç«¯æ—¶ï¼Œè¿è¡Œå…ƒæ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­è€Œéæ–‡ä»¶ç³»ç»Ÿ

#### 4. test_mlflow_local.py (8.0K)
- **ç±»å‹**: Pythonæµ‹è¯•è„šæœ¬
- **åŠŸèƒ½**: å…¨é¢æµ‹è¯•MLflowåŠŸèƒ½

## MLflowè®°å½•çš„å†…å®¹

### ğŸ“Š å®éªŒè·Ÿè¸ª (Experiment Tracking)

| ç±»å‹ | ç¤ºä¾‹å†…å®¹ | å­˜å‚¨ä½ç½® |
|------|----------|----------|
| **å®éªŒ** | `æœ¬åœ°æµ‹è¯•å®éªŒ_1722229126` | my.db |
| **è¿è¡Œ** | `æœ¬åœ°æµ‹è¯•è¿è¡Œ` | my.db |
| **è¿è¡ŒID** | `5fd98e0a3030475593856f358c661525` | my.db |

### ğŸ”§ å‚æ•°è®°å½• (Parameters)

```python
params = {
    "learning_rate": 0.01,
    "batch_size": 32,
    "epochs": 10,
    "model_type": "local_test"
}
```
- **å­˜å‚¨**: my.db ä¸­çš„å‚æ•°è¡¨
- **ç‰¹ç‚¹**: é”®å€¼å¯¹å½¢å¼ï¼Œä¸å¯å˜

### ğŸ“ˆ æŒ‡æ ‡è®°å½• (Metrics)

```python
# æ¨¡æ‹Ÿ5ä¸ªepochçš„è®­ç»ƒè¿‡ç¨‹
for epoch in range(5):
    accuracy = 0.7 + epoch * 0.05 + random_noise
    loss = 1.0 - epoch * 0.15 + random_noise
    mlflow.log_metric("accuracy", accuracy, step=epoch)
    mlflow.log_metric("loss", loss, step=epoch)
```
- **å­˜å‚¨**: my.db ä¸­çš„æŒ‡æ ‡è¡¨
- **ç‰¹ç‚¹**: æ—¶é—´åºåˆ—æ•°æ®ï¼Œæ”¯æŒstepå‚æ•°

### ğŸ’¾ æ•°æ®é›†è®°å½• (Dataset Logging)

```python
# è®°å½•100è¡Œæ¨¡æ‹Ÿæ•°æ®
sample_data = pd.DataFrame({
    "feature_1": np.random.randn(100),
    "feature_2": np.random.randn(100), 
    "target": np.random.randint(0, 2, 100)
})

dataset = mlflow.data.from_pandas(
    sample_data,
    source="æœ¬åœ°ç”Ÿæˆçš„æµ‹è¯•æ•°æ®",
    targets="target"
)
mlflow.log_input(dataset, context="è®­ç»ƒæ•°æ®")
```
- **å­˜å‚¨**: å…ƒæ•°æ®åœ¨my.dbï¼Œæ•°æ®æ‘˜è¦ä¿¡æ¯

### ğŸ“„ Artifactå­˜å‚¨

#### 1. æ–‡æœ¬æŠ¥å‘Š
- **æ–‡ä»¶**: `mlartifacts/1/{run_id}/artifacts/reports/test_report.txt`
- **å†…å®¹**: æµ‹è¯•æŠ¥å‘Šï¼ŒåŒ…å«æ—¶é—´æˆ³ã€å®éªŒä¿¡æ¯ã€æµ‹è¯•ç»“æœ

#### 2. æœºå™¨å­¦ä¹ æ¨¡å‹
- **è·¯å¾„**: `mlartifacts/1/models/m-{model_id}/artifacts/`
- **æ–‡ä»¶ç»„æˆ**:
  - `model.pkl`: sklearn LogisticRegressionæ¨¡å‹
  - `MLmodel`: MLflowæ¨¡å‹å…ƒæ•°æ®
  - `conda.yaml`: Condaç¯å¢ƒè§„èŒƒ
  - `python_env.yaml`: Pythonç¯å¢ƒé…ç½®  
  - `requirements.txt`: ä¾èµ–åŒ…åˆ—è¡¨

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨MLflowæœåŠ¡å™¨
```bash
cd /home/feng.hao.jie/test
mlflow server --port 3111 --backend-store-uri sqlite:///my.db
```

### 2. è¿è¡Œæµ‹è¯•è„šæœ¬
```bash
python test_mlflow_local.py
```

### 3. è®¿é—®Webç•Œé¢
- URL: http://127.0.0.1:3111
- åŠŸèƒ½: æŸ¥çœ‹å®éªŒã€æ¯”è¾ƒè¿è¡Œã€ä¸‹è½½artifacts

## æ–‡ä»¶å¤§å°æ€»è®¡

| æ–‡ä»¶/ç›®å½• | å¤§å° | è¯´æ˜ |
|-----------|------|------|
| my.db | 264K | SQLiteæ•°æ®åº“ï¼Œå­˜å‚¨æ‰€æœ‰å…ƒæ•°æ® |
| mlartifacts/ | 56K | æ¨¡å‹å’Œæ–‡ä»¶artifacts |
| mlruns/ | 4.0K | è¿è¡Œå…ƒæ•°æ®(åŸºæœ¬ä¸ºç©º) |
| test_mlflow_local.py | 8.0K | æµ‹è¯•è„šæœ¬ |
| **æ€»è®¡** | **~332K** | å®Œæ•´æµ‹è¯•ç¯å¢ƒ |

## ç‰¹æ€§æ¼”ç¤º

âœ… **å®éªŒç®¡ç†**: åˆ›å»ºå’Œç»„ç»‡æœºå™¨å­¦ä¹ å®éªŒ  
âœ… **å‚æ•°è·Ÿè¸ª**: è®°å½•å’Œæ¯”è¾ƒè¶…å‚æ•°  
âœ… **æŒ‡æ ‡ç›‘æ§**: è·Ÿè¸ªæ¨¡å‹æ€§èƒ½æŒ‡æ ‡  
âœ… **æ•°æ®é›†ç‰ˆæœ¬**: è®°å½•è®­ç»ƒæ•°æ®ä¿¡æ¯  
âœ… **æ¨¡å‹ç®¡ç†**: ä¿å­˜å’Œç‰ˆæœ¬åŒ–æ¨¡å‹  
âœ… **Artifactå­˜å‚¨**: å­˜å‚¨ä»»æ„æ–‡ä»¶å’ŒæŠ¥å‘Š  
âœ… **Webç•Œé¢**: å¯è§†åŒ–å®éªŒç»“æœ  

## ç¯å¢ƒè¦æ±‚

- Python 3.x
- MLflow
- pandas
- numpy  
- scikit-learn
- SQLite (ç³»ç»Ÿå†…ç½®)

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®æŒä¹…æ€§**: åˆ é™¤my.dbä¼šä¸¢å¤±æ‰€æœ‰å®éªŒæ•°æ®
2. **Artifactå­˜å‚¨**: mlartifactsç›®å½•åŒ…å«æ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶
3. **ç«¯å£é…ç½®**: é»˜è®¤ä½¿ç”¨3111ç«¯å£ï¼Œå¯æ ¹æ®éœ€è¦ä¿®æ”¹
4. **å­˜å‚¨åç«¯**: å½“å‰ä½¿ç”¨SQLiteï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨PostgreSQL

---

*æœ€åæ›´æ–°: 2025-07-29*  
*MLflowç‰ˆæœ¬: 3.1.4*  
*ç¯å¢ƒ: Linux conda(factor)* 